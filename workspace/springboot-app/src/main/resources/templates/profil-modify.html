<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/fragment-head :: head(
	'Modification du profil de ' + ${user.pseudo} + ' | MÃ©moires vives',
	'',
	'noindex, nofollow',
	'',
	~{}
)}">
</head>

<body class="min-h-screen flex flex-col">
	<div th:replace="~{fragments/fragment-header :: header}"></div>

	<main class="mt-[80px] w-full flex-grow flex flex-col items-center">
		<h1 class="h1-title">Modifier son profil</h1>
		<form th:action="@{/profil/modify}" method="POST" th:object="${user}"
			class="user-create-form w-full max-w-lg flex flex-col" enctype="multipart/form-data" id="formWithImage">

			<div th:replace="~{fragments/errors/fragment-errors-global::frag-errors}"></div>

			<div class="inputs-container">
				<div class="pseudo-input">
					<label for="inputPseudo" class="form-label">pseudo </label>
					<!--					<input id="inputPseudo" th:field="*{pseudo}" type="text" pattern="^\w+$" maxlength="30" required>-->
					<input id="inputPseudo" th:field="*{pseudo}" type="text" class="form-input">
					<div th:replace="~{fragments/errors/fragment-error :: frag-error(pseudo)}"></div>
				</div>
				<div class="email-input">
					<label for="inputEmail" class="form-label">email </label>
					<!--					<input id="inputEmail" th:field="*{email}" type="email" required>-->
					<input id="inputEmail" th:field="*{email}" type="email" class="form-input">
					<div th:replace="~{fragments/errors/fragment-error :: frag-error(email)}"></div>
				</div>
				<div class="currentPassword-input">
					<label for="inputCurrentPassword"
						th:text="${user.userId == #authentication.principal.user.userId ? 'mot de passe actuel' : 'mot de passe administrateur'}"
						class="form-label">
					</label>
					<div class="relative w-full">
						<input id="inputCurrentPassword" name="currentPassword" type="password" class="form-input">
						<button type="button"
							class="password-toggle absolute inset-y-0 right-0 flex items-center pr-3 text-gray-500 hover:text-gray-700">&#9215;</button>
					</div>
					<div
						th:replace="~{fragments/errors/fragment-custom-field-error :: frag-custom-field-error('user', 'currentPassword')}">
					</div>
				</div>
				<div class="password-input">
					<label for="inputPassword" class="form-label">nouveau mot de passe </label>
					<div class="relative w-full">
						<input id="inputPassword" th:field="*{password}" type="password" class="form-input">
						<button type="button"
							class="password-toggle absolute inset-y-0 right-0 flex items-center pr-3 text-gray-500 hover:text-gray-700">&#9215;</button>
					</div>
				</div>
				<div class="confirm-password-input">
					<label for="inputPasswordConfirm" class="form-label">confirmez votre nouveau mot de passe </label>
					<div class="relative w-full">
						<input id="inputPasswordConfirm" th:field="*{passwordConfirm}" type="password"
							class="form-input">
						<button type="button"
							class="password-toggle absolute inset-y-0 right-0 flex items-center pr-3 text-gray-500 hover:text-gray-700">&#9215;</button>
					</div>
				</div>
				<div th:replace="~{fragments/errors/fragment-error :: frag-error(password)}"></div>

				<div class="image-input mt-2 flex flex-col items-start w-auto">
					<span class="form-label">Photo de profil</span>
					<div class="flex items-center gap-2">
						<label for="imageInput"
							class="cursor-pointer min-w-[80px] min-h-[80px] w-1/6 h-1/6 max-w-3xs max-h-[256px] shrink-0 inline-block relative aspect-square">
							<img id="image" class="rounded-[50%] w-full h-full object-cover"
								data-placeholder="/images/public/user-placeholder.png"
								th:src="${#strings.isEmpty(user.mediaUUID)} ? @{/images/public/user-placeholder.png} : @{/uploads/{filename}(filename=${user.mediaUUID})}"
								th:alt="${#strings.isEmpty(user.mediaUUID)} ? ${user.pseudo} + ' n\'a pas d\'image de profil' : 'image de profil de ' + ${user.pseudo}" />
						</label>
						<button type="button" id="removeImageBtn" class="p-2 rounded-full"
							th:classappend="${#strings.isEmpty(user.mediaUUID)} ? ' hidden' : ''" title="Supprimer l'image">
							<img src="/images/public/trash.png" class="w-5 h-5 opacity-70 hover:opacity-100"
								alt="supprimer l'image" />
						</button>

					</div>
					<input type="hidden" th:field="*{mediaUUID}" />
					<input id="imageInput" name="image" type="file" accept="image/png, image/jpeg" class="hidden" />
					<input type="hidden" name="removeImage" id="removeImage" value="false">
				</div>
				<input id="userId" th:field="*{userId}" type="hidden" />
			</div>

			<div class="buttons-container">
				<button type="submit" class="button create form-button">Modifier</button>
				<a th:href="@{/}" class="button cancel form-button">Annuler</a>
			</div>
		</form>

		<div id="upload-status" class="hidden mt-4 p-3 bg-[#7e9076] text-white rounded flex items-center space-x-2">
			<div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
			<span>Redimensionnement de l'image en cours...</span>
		</div>
	</main>
	<div th:replace="~{fragments/fragment-footer :: footer}"></div>
	<script src="https://cdn.jsdelivr.net/npm/pica@9.0.1/dist/pica.min.js"></script>
	<script src="/js/images.js"></script>
	<script src="/js/password.js"></script>
</body>

</html>